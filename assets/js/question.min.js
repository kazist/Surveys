jQuery(document).ready(function(){question_form.init()});question_form=function(){return{init:function(){question_form.addEvents(jQuery("body"))},addEvents:function(a){a.find("#type").change(function(){question_form.addTypeEvents(jQuery(this))});a.find(".add-question-option").click(function(){question_form.addQuestionOptionEvents(jQuery(this))});a.find(".delete-question-option").click(function(){question_form.deleteQuestionOptionEvents(jQuery(this))});a.find(".save-new-question").click(function(){question_form.saveNewQuestion(jQuery(this))});a.find(".save-existing-question").click(function(){question_form.saveExistingQuestion(jQuery(this))});a.find(".survey-question-delete").click(function(){question_form.deleteSurveyQuestionEvents(jQuery(this))});return a},addTypeEvents:function(b){var a=b.val();if(a!==""){jQuery(".question-text").hide();jQuery(".question-"+a+"-sample").show();if(!jQuery(".question-"+a+"-sample tbody tr").length){jQuery(".question-"+a+"-sample .add-question-option").trigger("click")}}},addQuestionOptionEvents:function(b){var a=b.attr("question_type");var d=jQuery(".option-"+a+"-tr-sample tbody").html();var c=parseInt(b.closest("table").find("tbody tr").length)+1;d=question_form.addEvents(jQuery(d));d.find(".option-answer").html('<input type="checkbox" name="form[quiz_params][new][answer]" value="1">');d.find(".option-answer input").attr("name","form[quiz_params][new][answer]["+c+"]");d.find(".option-label input").attr("name","form[quiz_params][new][label]["+c+"]");d.find(".option-image input").attr("name","form[quiz_params][new][image]["+c+"]");d.find(".option-answer input").addClass("question-input");d.find(".option-label input").addClass("question-input");d.find(".option-image input").addClass("question-input");b.closest("table").find("tbody").append(d);b.closest("table").find("tbody").iCheck({checkboxClass:"icheckbox_minimal",radioClass:"iradio_minimal"})},deleteQuestionOptionEvents:function(a){var b=confirm("Are you sure?");if(b){a.closest("tr").remove()}},deleteSurveyQuestionEvents:function(d){var f=confirm("Are you sure?");if(f){var c=d.closest("form").find(".survey_id").val();var b=d.attr("question_id");var a=d.attr("survey_question_id");if(b){data={};data=kazist.createNestedObject(data,["form[question_id]"],b);data=kazist.createNestedObject(data,["form[survey_id]"],c);data=kazist.createNestedObject(data,["form[id]"],a);var e=kazist.callAjaxByRoute("surveys.questions.ajaxdeletesurveyquestion",data,true);survey_form.loadSurveyForm(c)}}},saveExistingQuestion:function(e){var g="Validation Error";var d="";var c=true;var b=e.closest("form").find(".existing_question").val();var a=e.closest("form").find(".survey_id").val();if(!parseInt(a)){c=false;d+="<br>No Survey set."}if(b===""){c=false;d+="<br>Select Question Above."}if(c){data={};data=kazist.createNestedObject(data,["form[question_id]"],b);data=kazist.createNestedObject(data,["form[survey_id]"],a);var f=kazist.callAjaxByRoute("surveys.questions.ajaxaddsurveyquestion",data,true);survey_form.loadSurveyForm(a)}else{kazist.showDialog(g,d,"error");return false}},saveNewQuestion:function(g){var i="Validation Error";var l="";var k=true;var b=g.closest("form").find(".question_id").val();var c=g.closest("form").find(".survey_id").val();var j=g.closest(".question-form").find("#type").val();var h=g.closest(".question-form").find("#question").val();var e=g.closest(".question-form").find(".question-"+j+"-sample .option-label input");b=(typeof b!=="undefined")?b:0;c=(typeof c!=="undefined")?c:0;e.each(function(m,n){g=jQuery(this);if(g.val()===""){l+="<br>"+j+" Options(labels) "+(m+1)+" should not be empty.";g.addClass("has-error");k=false}g.removeClass("has-error")});if(j===""){k=false;l+="<br>Type is a required Fields and can not be empty."}if(h===""){k=false;l+="<br>Question is a required Fields and can not be empty."}if(k){var a=g.closest(".question-form").find(":input");var f=kazist.serializeFormJSON(a);f=kazist.createNestedObject(f,["form[id]"],b);f=kazist.createNestedObject(f,["form[survey_id]"],c);var d=kazist.callAjaxByRoute("surveys.questions.ajaxaddquestion",f,true);if(typeof c=="undefined"){if(typeof d.question_id!="undefined"){window.location=kazicode.url+"?surveys/questions/edit"+d.question_id}else{window.location=kazicode.url+"?surveys/questions"}}else{if(typeof d.question_id!="undefined"){survey_form.loadSurveyForm(c)}}return true}else{kazist.showDialog(i,l,"error");return false}}}}();